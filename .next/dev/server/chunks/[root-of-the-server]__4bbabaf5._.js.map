{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///data/OpenAlex-Analysis/InnoSciHub/scientific-knowledge-navigation/lib/model-config.ts"],"sourcesContent":["export const MODEL_CONFIG = {\n  apiKey:\n    \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJHcm91cE5hbWUiOiJTaGliaW5nIFhpYW5nIiwiVXNlck5hbWUiOiJTaGliaW5nIFhpYW5nIiwiQWNjb3VudCI6IiIsIlN1YmplY3RJRCI6IjE5ODMzMzg3ODkzNTQ4NzM0MjQiLCJQaG9uZSI6IjE1MjgwOTk1NjIzIiwiR3JvdXBJRCI6IjE5ODMzMzg3ODkzNDY0ODQ4MTYiLCJQYWdlTmFtZSI6IiIsIk1haWwiOiIiLCJDcmVhdGVUaW1lIjoiMjAyNS0xMS0xNyAwMTo0NzoxMiIsIlRva2VuVHlwZSI6NCwiaXNzIjoibWluaW1heCJ9.J9DXYnr6kbFABZZREpiuEJFsjIq7gSfNcHqjlBVc0RhPV3ayukzfpQOdescWWt_dDNar704FKZ3ObhVlv8SoZqVZBgqRY754M5xdkGtZ83ytI0MF6eXTyPVMho-L_NFM7ZagKhSXuDJS8M5dZ6ccZfcsK8zHFh6mUuhJV9x2-jyoUPFtWNNCfYEitOfGdxuxIoiJdvHz6mJNRfhVGELxhw1kr6v-xwf3CEAILZCYSABIGfeTkL6IrC69JpPheN8pgCASD_Qh6wKlGZnrNiHV5sFcBP-ADELucPT5QSo_Wj7MvsG9csHeONubxxYKKK6S5TvEIuGLnmCjcRG5k1mEiA\",\n  baseURL: \"https://api.minimaxi.com/v1\",\n  model: \"MiniMax-M2-Stable\",\n}\n\nexport const PRESET_MODELS = [\n  {\n    id: \"doubao-pro\",\n    name: \"Doubao Seed 1.6 Lite\",\n    baseURL: \"https://ark.cn-beijing.volces.com/api/v3\",\n    connectionURL: \"https://ark.cn-beijing.volces.com/api/v3/chat/completions\",\n    apiKey: \"2ee34654-7f98-46bc-b879-6ed4fb57eddf\",\n    model: \"doubao-seed-1-6-lite-251015\",\n    provider: \"doubao\",\n  },\n  {\n    id: \"minimax\",\n    name: \"MiniMax M2\",\n    baseURL: \"https://api.minimaxi.com/v1\",\n    connectionURL: \"https://api.minimaxi.com/v1/chat/completions\",\n    apiKey: MODEL_CONFIG.apiKey,\n    model: \"MiniMax-M2-Stable\",\n    provider: \"minimax\",\n  },\n  {\n    id: \"ChatGLM\",\n    name: \"ChatGLM-4.6\",\n    baseURL: \"https://open.bigmodel.cn/api/coding/paas/v4\",\n    connectionURL: \"https://open.bigmodel.cn/api/coding/paas/v4/chat/completions\",\n    apiKey: MODEL_CONFIG.apiKey,\n    model: \"glm-4.6\",\n    provider: \"ChatGLM\",\n  }\n]\n"],"names":[],"mappings":";;;;;;AAAO,MAAM,eAAe;IAC1B,QACE;IACF,SAAS;IACT,OAAO;AACT;AAEO,MAAM,gBAAgB;IAC3B;QACE,IAAI;QACJ,MAAM;QACN,SAAS;QACT,eAAe;QACf,QAAQ;QACR,OAAO;QACP,UAAU;IACZ;IACA;QACE,IAAI;QACJ,MAAM;QACN,SAAS;QACT,eAAe;QACf,QAAQ,aAAa,MAAM;QAC3B,OAAO;QACP,UAAU;IACZ;IACA;QACE,IAAI;QACJ,MAAM;QACN,SAAS;QACT,eAAe;QACf,QAAQ,aAAa,MAAM;QAC3B,OAAO;QACP,UAAU;IACZ;CACD"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///data/OpenAlex-Analysis/InnoSciHub/scientific-knowledge-navigation/lib/agents/knowledge-network-agent.ts"],"sourcesContent":["/**\n * Knowledge Network Agent\n * \n * This module provides a knowledge network generation agent that can analyze text\n * and generate causal knowledge networks using AI models.\n */\n\nimport { PRESET_MODELS } from '@/lib/model-config'\n\nexport interface NetworkNode {\n  id: string\n  label: string\n  type: \"concept\" | \"entity\" | \"method\"\n  x?: number\n  y?: number\n  radius?: number\n}\n\nexport interface NetworkLink {\n  source: string\n  target: string\n  label?: string\n  type?: string\n}\n\nexport interface NetworkData {\n  nodes: NetworkNode[]\n  links: NetworkLink[]\n  metadata?: {\n    nodeCount?: number\n    linkCount?: number\n    inputText?: string\n    model?: string\n    timestamp?: string\n    fallback?: boolean\n  }\n}\n\nexport interface GenerationProgress {\n  step: string\n  progress: number\n  message: string\n  timestamp: number\n}\n\nexport class KnowledgeNetworkAgent {\n  private modelConfig: any\n  private sessionId: string\n  private progressCallback?: (progress: GenerationProgress) => void\n\n  constructor(modelId: string, sessionId: string, progressCallback?: (progress: GenerationProgress) => void) {\n    this.modelConfig = PRESET_MODELS.find(m => m.id === modelId) || PRESET_MODELS[0]\n    this.sessionId = sessionId\n    this.progressCallback = progressCallback\n  }\n\n  /**\n   * Generate a knowledge network from input text\n   */\n  async generateNetwork(query: string): Promise<NetworkData> {\n    this.updateProgress('initialization', 10, 'Initializing knowledge network generation...')\n    \n    try {\n      // Step 1: Initialize model connection\n      this.updateProgress('model_initialization', 20, 'Connecting to AI model...')\n      \n      // Step 2: Analyze query with AI model\n      this.updateProgress('analysis', 30, 'Analyzing query with AI model...')\n      const modelResponse = await this.queryModel(query)\n      \n      // Step 3: Extract network structure from response\n      this.updateProgress('extraction', 50, 'Extracting network structure...')\n      const extractedData = this.extractNetworkData(modelResponse)\n      \n      // Step 4: Build final network with layout\n      this.updateProgress('construction', 70, 'Building network structure...')\n      const networkData = this.buildNetwork(query, extractedData)\n      \n      // Step 5: Finalize network\n      this.updateProgress('finalization', 90, 'Finalizing network visualization...')\n      const finalNetwork = this.finalizeNetwork(networkData)\n      \n      this.updateProgress('complete', 100, 'Knowledge network generated successfully!')\n      \n      return finalNetwork\n      \n    } catch (error) {\n      console.error('Network generation failed:', error)\n      this.updateProgress('error', 0, `Error: ${error instanceof Error ? error.message : 'Unknown error'}`)\n      \n      // Return fallback network\n      return this.createFallbackNetwork(query)\n    }\n  }\n\n  /**\n   * Query the AI model with the user's input\n   */\n  private async queryModel(query: string): Promise<string> {\n    const prompt = `You are a knowledge network extraction expert. Analyze the following query and generate a causal knowledge network.\n\nQuery: \"${query}\"\n\nYour task is to:\n1. Identify key concepts, entities, and methods related to the query\n2. Determine causal relationships between them\n3. Structure this as a knowledge network\n\nReturn your response in the following JSON format:\n{\n  \"nodes\": [\n    {\"id\": \"n1\", \"label\": \"Concept Name\", \"type\": \"concept\"},\n    {\"id\": \"n2\", \"label\": \"Entity Name\", \"type\": \"entity\"},\n    {\"id\": \"n3\", \"label\": \"Method Name\", \"type\": \"method\"}\n  ],\n  \"links\": [\n    {\"source\": \"n1\", \"target\": \"n2\", \"label\": \"causes\", \"type\": \"causal\"},\n    {\"source\": \"n2\", \"target\": \"n3\", \"label\": \"uses\", \"type\": \"methodological\"}\n  ]\n}\n\nImportant:\n- Use \"concept\" for abstract ideas, theories, and principles\n- Use \"entity\" for concrete objects, data, and variables\n- Use \"method\" for techniques, algorithms, and procedures\n- Focus on causal relationships (causes, enables, requires, influences)\n- Return only the JSON, no additional text`\n\n    const response = await fetch(this.modelConfig.connectionURL || `${this.modelConfig.baseURL}/chat/completions`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.modelConfig.apiKey}`\n      },\n      body: JSON.stringify({\n        model: this.modelConfig.model,\n        messages: [\n          {\n            role: 'system',\n            content: 'You are a knowledge network extraction expert who specializes in identifying causal relationships between concepts, entities, and methods.'\n          },\n          {\n            role: 'user',\n            content: prompt\n          }\n        ],\n        temperature: 0.7,\n        max_tokens: 2000\n      })\n    })\n\n    if (!response.ok) {\n      throw new Error(`Model API error: ${response.status} ${response.statusText}`)\n    }\n\n    const data = await response.json()\n    return data.choices?.[0]?.message?.content || ''\n  }\n\n  /**\n   * Extract structured network data from model response\n   */\n  private extractNetworkData(response: string): { nodes: any[], links: any[] } {\n    try {\n      // Try to extract JSON from response\n      const jsonMatch = response.match(/```json\\s*([\\s\\S]*?)\\s*```/)\n      if (jsonMatch) {\n        return JSON.parse(jsonMatch[1])\n      }\n\n      // Try to find JSON object directly\n      const objectMatch = response.match(/\\{[\\s\\S]*\\}/)\n      if (objectMatch) {\n        return JSON.parse(objectMatch[0])\n      }\n\n      // If no JSON found, return empty structure\n      return { nodes: [], links: [] }\n      \n    } catch (error) {\n      console.error('Failed to extract network data:', error)\n      return { nodes: [], links: [] }\n    }\n  }\n\n  /**\n   * Build network from extracted data\n   */\n  private buildNetwork(query: string, extractedData: { nodes: any[], links: any[] }): NetworkData {\n    const nodes: NetworkNode[] = []\n    const links: NetworkLink[] = []\n\n    // Process nodes\n    if (extractedData.nodes && extractedData.nodes.length > 0) {\n      extractedData.nodes.forEach((node, index) => {\n        nodes.push({\n          id: node.id || `node_${index}`,\n          label: node.label || `Node ${index + 1}`,\n          type: node.type || 'concept',\n          radius: this.getNodeRadius(node.type || 'concept')\n        })\n      })\n    } else {\n      // Create nodes from query analysis\n      const queryNodes = this.analyzeQueryForNodes(query)\n      nodes.push(...queryNodes)\n    }\n\n    // Process links\n    if (extractedData.links && extractedData.links.length > 0) {\n      extractedData.links.forEach(link => {\n        links.push({\n          source: link.source,\n          target: link.target,\n          label: link.label || 'relates_to',\n          type: link.type || 'relates_to'\n        })\n      })\n    } else {\n      // Create basic connections between nodes\n      for (let i = 0; i < nodes.length - 1; i++) {\n        links.push({\n          source: nodes[i].id,\n          target: nodes[i + 1].id,\n          label: 'relates_to',\n          type: 'relates_to'\n        })\n      }\n    }\n\n    return { nodes, links }\n  }\n\n  /**\n   * Analyze query to extract basic nodes\n   */\n  private analyzeQueryForNodes(query: string): NetworkNode[] {\n    const nodes: NetworkNode[] = []\n    \n    // Simple keyword extraction for fallback\n    const concepts = ['统计学', '深度学习', '机器学习', '概率论', '神经网络', '回归', '分类']\n    const entities = ['数据', '算法', '模型', '参数', '特征', '样本']\n    const methods = ['分析', '预测', '训练', '优化', '计算', '验证']\n    \n    const allTerms = [...concepts, ...entities, ...methods]\n    const foundTerms = allTerms.filter(term => query.includes(term))\n    \n    foundTerms.slice(0, 5).forEach((term, index) => {\n      let type: 'concept' | 'entity' | 'method' = 'concept'\n      if (entities.includes(term)) type = 'entity'\n      else if (methods.includes(term)) type = 'method'\n      \n      nodes.push({\n        id: `node_${index}`,\n        label: term,\n        type,\n        radius: this.getNodeRadius(type)\n      })\n    })\n    \n    // If no terms found, create a default node\n    if (nodes.length === 0) {\n      nodes.push({\n        id: 'node_0',\n        label: 'Query Analysis',\n        type: 'concept',\n        radius: 30\n      })\n    }\n    \n    return nodes\n  }\n\n  /**\n   * Get appropriate radius for node type\n   */\n  private getNodeRadius(type: string): number {\n    switch (type) {\n      case 'concept': return 30\n      case 'entity': return 25\n      case 'method': return 20\n      default: return 25\n    }\n  }\n\n  /**\n   * Apply layout and finalize network\n   */\n  private finalizeNetwork(network: NetworkData): NetworkData {\n    // Apply force-directed layout for initial positions\n    const centerX = 400\n    const centerY = 300\n    const radius = Math.min(200, 300 / Math.sqrt(network.nodes.length))\n    \n    network.nodes.forEach((node, index) => {\n      const angle = (2 * Math.PI * index) / network.nodes.length\n      node.x = centerX + radius * Math.cos(angle)\n      node.y = centerY + radius * Math.sin(angle)\n    })\n    \n    // Add metadata\n    network.metadata = {\n      nodeCount: network.nodes.length,\n      linkCount: network.links.length,\n      model: this.modelConfig.name,\n      timestamp: new Date().toISOString()\n    }\n    \n    return network\n  }\n\n  /**\n   * Create fallback network when generation fails\n   */\n  private createFallbackNetwork(query: string): NetworkData {\n    return {\n      nodes: [\n        {\n          id: 'n1',\n          label: 'Query Analysis',\n          type: 'concept',\n          x: 400,\n          y: 200,\n          radius: 30\n        },\n        {\n          id: 'n2',\n          label: 'Related Concept',\n          type: 'entity',\n          x: 300,\n          y: 300,\n          radius: 25\n        },\n        {\n          id: 'n3',\n          label: 'Method',\n          type: 'method',\n          x: 500,\n          y: 300,\n          radius: 20\n        }\n      ],\n      links: [\n        {\n          source: 'n1',\n          target: 'n2',\n          label: 'relates_to',\n          type: 'relates_to'\n        },\n        {\n          source: 'n1',\n          target: 'n3',\n          label: 'uses',\n          type: 'relates_to'\n        }\n      ],\n      metadata: {\n        nodeCount: 3,\n        linkCount: 2,\n        inputText: query,\n        fallback: true,\n        timestamp: new Date().toISOString()\n      }\n    }\n  }\n\n  /**\n   * Update progress with callback\n   */\n  private updateProgress(step: string, progress: number, message: string): void {\n    const progressData: GenerationProgress = {\n      step,\n      progress,\n      message,\n      timestamp: Date.now()\n    }\n    \n    if (this.progressCallback) {\n      this.progressCallback(progressData)\n    }\n    \n    console.log(`[KnowledgeNetworkAgent] ${progress}% - ${step}: ${message}`)\n  }\n}"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;AAED;;AAsCO,MAAM;IACH,YAAgB;IAChB,UAAiB;IACjB,iBAAyD;IAEjE,YAAY,OAAe,EAAE,SAAiB,EAAE,gBAAyD,CAAE;QACzG,IAAI,CAAC,WAAW,GAAG,yIAAa,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,YAAY,yIAAa,CAAC,EAAE;QAChF,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,gBAAgB,GAAG;IAC1B;IAEA;;GAEC,GACD,MAAM,gBAAgB,KAAa,EAAwB;QACzD,IAAI,CAAC,cAAc,CAAC,kBAAkB,IAAI;QAE1C,IAAI;YACF,sCAAsC;YACtC,IAAI,CAAC,cAAc,CAAC,wBAAwB,IAAI;YAEhD,sCAAsC;YACtC,IAAI,CAAC,cAAc,CAAC,YAAY,IAAI;YACpC,MAAM,gBAAgB,MAAM,IAAI,CAAC,UAAU,CAAC;YAE5C,kDAAkD;YAClD,IAAI,CAAC,cAAc,CAAC,cAAc,IAAI;YACtC,MAAM,gBAAgB,IAAI,CAAC,kBAAkB,CAAC;YAE9C,0CAA0C;YAC1C,IAAI,CAAC,cAAc,CAAC,gBAAgB,IAAI;YACxC,MAAM,cAAc,IAAI,CAAC,YAAY,CAAC,OAAO;YAE7C,2BAA2B;YAC3B,IAAI,CAAC,cAAc,CAAC,gBAAgB,IAAI;YACxC,MAAM,eAAe,IAAI,CAAC,eAAe,CAAC;YAE1C,IAAI,CAAC,cAAc,CAAC,YAAY,KAAK;YAErC,OAAO;QAET,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,IAAI,CAAC,cAAc,CAAC,SAAS,GAAG,CAAC,OAAO,EAAE,iBAAiB,QAAQ,MAAM,OAAO,GAAG,iBAAiB;YAEpG,0BAA0B;YAC1B,OAAO,IAAI,CAAC,qBAAqB,CAAC;QACpC;IACF;IAEA;;GAEC,GACD,MAAc,WAAW,KAAa,EAAmB;QACvD,MAAM,SAAS,CAAC;;QAEZ,EAAE,MAAM;;;;;;;;;;;;;;;;;;;;;;;;;0CAyB0B,CAAC;QAEvC,MAAM,WAAW,MAAM,MAAM,IAAI,CAAC,WAAW,CAAC,aAAa,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,iBAAiB,CAAC,EAAE;YAC7G,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE;YACtD;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO,IAAI,CAAC,WAAW,CAAC,KAAK;gBAC7B,UAAU;oBACR;wBACE,MAAM;wBACN,SAAS;oBACX;oBACA;wBACE,MAAM;wBACN,SAAS;oBACX;iBACD;gBACD,aAAa;gBACb,YAAY;YACd;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,SAAS,MAAM,CAAC,CAAC,EAAE,SAAS,UAAU,EAAE;QAC9E;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,OAAO,KAAK,OAAO,EAAE,CAAC,EAAE,EAAE,SAAS,WAAW;IAChD;IAEA;;GAEC,GACD,AAAQ,mBAAmB,QAAgB,EAAkC;QAC3E,IAAI;YACF,oCAAoC;YACpC,MAAM,YAAY,SAAS,KAAK,CAAC;YACjC,IAAI,WAAW;gBACb,OAAO,KAAK,KAAK,CAAC,SAAS,CAAC,EAAE;YAChC;YAEA,mCAAmC;YACnC,MAAM,cAAc,SAAS,KAAK,CAAC;YACnC,IAAI,aAAa;gBACf,OAAO,KAAK,KAAK,CAAC,WAAW,CAAC,EAAE;YAClC;YAEA,2CAA2C;YAC3C,OAAO;gBAAE,OAAO,EAAE;gBAAE,OAAO,EAAE;YAAC;QAEhC,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,mCAAmC;YACjD,OAAO;gBAAE,OAAO,EAAE;gBAAE,OAAO,EAAE;YAAC;QAChC;IACF;IAEA;;GAEC,GACD,AAAQ,aAAa,KAAa,EAAE,aAA6C,EAAe;QAC9F,MAAM,QAAuB,EAAE;QAC/B,MAAM,QAAuB,EAAE;QAE/B,gBAAgB;QAChB,IAAI,cAAc,KAAK,IAAI,cAAc,KAAK,CAAC,MAAM,GAAG,GAAG;YACzD,cAAc,KAAK,CAAC,OAAO,CAAC,CAAC,MAAM;gBACjC,MAAM,IAAI,CAAC;oBACT,IAAI,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,OAAO;oBAC9B,OAAO,KAAK,KAAK,IAAI,CAAC,KAAK,EAAE,QAAQ,GAAG;oBACxC,MAAM,KAAK,IAAI,IAAI;oBACnB,QAAQ,IAAI,CAAC,aAAa,CAAC,KAAK,IAAI,IAAI;gBAC1C;YACF;QACF,OAAO;YACL,mCAAmC;YACnC,MAAM,aAAa,IAAI,CAAC,oBAAoB,CAAC;YAC7C,MAAM,IAAI,IAAI;QAChB;QAEA,gBAAgB;QAChB,IAAI,cAAc,KAAK,IAAI,cAAc,KAAK,CAAC,MAAM,GAAG,GAAG;YACzD,cAAc,KAAK,CAAC,OAAO,CAAC,CAAA;gBAC1B,MAAM,IAAI,CAAC;oBACT,QAAQ,KAAK,MAAM;oBACnB,QAAQ,KAAK,MAAM;oBACnB,OAAO,KAAK,KAAK,IAAI;oBACrB,MAAM,KAAK,IAAI,IAAI;gBACrB;YACF;QACF,OAAO;YACL,yCAAyC;YACzC,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,GAAG,GAAG,IAAK;gBACzC,MAAM,IAAI,CAAC;oBACT,QAAQ,KAAK,CAAC,EAAE,CAAC,EAAE;oBACnB,QAAQ,KAAK,CAAC,IAAI,EAAE,CAAC,EAAE;oBACvB,OAAO;oBACP,MAAM;gBACR;YACF;QACF;QAEA,OAAO;YAAE;YAAO;QAAM;IACxB;IAEA;;GAEC,GACD,AAAQ,qBAAqB,KAAa,EAAiB;QACzD,MAAM,QAAuB,EAAE;QAE/B,yCAAyC;QACzC,MAAM,WAAW;YAAC;YAAO;YAAQ;YAAQ;YAAO;YAAQ;YAAM;SAAK;QACnE,MAAM,WAAW;YAAC;YAAM;YAAM;YAAM;YAAM;YAAM;SAAK;QACrD,MAAM,UAAU;YAAC;YAAM;YAAM;YAAM;YAAM;YAAM;SAAK;QAEpD,MAAM,WAAW;eAAI;eAAa;eAAa;SAAQ;QACvD,MAAM,aAAa,SAAS,MAAM,CAAC,CAAA,OAAQ,MAAM,QAAQ,CAAC;QAE1D,WAAW,KAAK,CAAC,GAAG,GAAG,OAAO,CAAC,CAAC,MAAM;YACpC,IAAI,OAAwC;YAC5C,IAAI,SAAS,QAAQ,CAAC,OAAO,OAAO;iBAC/B,IAAI,QAAQ,QAAQ,CAAC,OAAO,OAAO;YAExC,MAAM,IAAI,CAAC;gBACT,IAAI,CAAC,KAAK,EAAE,OAAO;gBACnB,OAAO;gBACP;gBACA,QAAQ,IAAI,CAAC,aAAa,CAAC;YAC7B;QACF;QAEA,2CAA2C;QAC3C,IAAI,MAAM,MAAM,KAAK,GAAG;YACtB,MAAM,IAAI,CAAC;gBACT,IAAI;gBACJ,OAAO;gBACP,MAAM;gBACN,QAAQ;YACV;QACF;QAEA,OAAO;IACT;IAEA;;GAEC,GACD,AAAQ,cAAc,IAAY,EAAU;QAC1C,OAAQ;YACN,KAAK;gBAAW,OAAO;YACvB,KAAK;gBAAU,OAAO;YACtB,KAAK;gBAAU,OAAO;YACtB;gBAAS,OAAO;QAClB;IACF;IAEA;;GAEC,GACD,AAAQ,gBAAgB,OAAoB,EAAe;QACzD,oDAAoD;QACpD,MAAM,UAAU;QAChB,MAAM,UAAU;QAChB,MAAM,SAAS,KAAK,GAAG,CAAC,KAAK,MAAM,KAAK,IAAI,CAAC,QAAQ,KAAK,CAAC,MAAM;QAEjE,QAAQ,KAAK,CAAC,OAAO,CAAC,CAAC,MAAM;YAC3B,MAAM,QAAQ,AAAC,IAAI,KAAK,EAAE,GAAG,QAAS,QAAQ,KAAK,CAAC,MAAM;YAC1D,KAAK,CAAC,GAAG,UAAU,SAAS,KAAK,GAAG,CAAC;YACrC,KAAK,CAAC,GAAG,UAAU,SAAS,KAAK,GAAG,CAAC;QACvC;QAEA,eAAe;QACf,QAAQ,QAAQ,GAAG;YACjB,WAAW,QAAQ,KAAK,CAAC,MAAM;YAC/B,WAAW,QAAQ,KAAK,CAAC,MAAM;YAC/B,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI;YAC5B,WAAW,IAAI,OAAO,WAAW;QACnC;QAEA,OAAO;IACT;IAEA;;GAEC,GACD,AAAQ,sBAAsB,KAAa,EAAe;QACxD,OAAO;YACL,OAAO;gBACL;oBACE,IAAI;oBACJ,OAAO;oBACP,MAAM;oBACN,GAAG;oBACH,GAAG;oBACH,QAAQ;gBACV;gBACA;oBACE,IAAI;oBACJ,OAAO;oBACP,MAAM;oBACN,GAAG;oBACH,GAAG;oBACH,QAAQ;gBACV;gBACA;oBACE,IAAI;oBACJ,OAAO;oBACP,MAAM;oBACN,GAAG;oBACH,GAAG;oBACH,QAAQ;gBACV;aACD;YACD,OAAO;gBACL;oBACE,QAAQ;oBACR,QAAQ;oBACR,OAAO;oBACP,MAAM;gBACR;gBACA;oBACE,QAAQ;oBACR,QAAQ;oBACR,OAAO;oBACP,MAAM;gBACR;aACD;YACD,UAAU;gBACR,WAAW;gBACX,WAAW;gBACX,WAAW;gBACX,UAAU;gBACV,WAAW,IAAI,OAAO,WAAW;YACnC;QACF;IACF;IAEA;;GAEC,GACD,AAAQ,eAAe,IAAY,EAAE,QAAgB,EAAE,OAAe,EAAQ;QAC5E,MAAM,eAAmC;YACvC;YACA;YACA;YACA,WAAW,KAAK,GAAG;QACrB;QAEA,IAAI,IAAI,CAAC,gBAAgB,EAAE;YACzB,IAAI,CAAC,gBAAgB,CAAC;QACxB;QAEA,QAAQ,GAAG,CAAC,CAAC,wBAAwB,EAAE,SAAS,IAAI,EAAE,KAAK,EAAE,EAAE,SAAS;IAC1E;AACF"}},
    {"offset": {"line": 429, "column": 0}, "map": {"version":3,"sources":["file:///data/OpenAlex-Analysis/InnoSciHub/scientific-knowledge-navigation/app/api/agent-network/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { KnowledgeNetworkAgent, NetworkData, GenerationProgress } from '@/lib/agents/knowledge-network-agent'\n\n// In-memory progress tracking (in production, use Redis or database)\nconst progressMap = new Map<string, GenerationProgress>()\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { query, modelId, sessionId } = await request.json()\n\n    if (!query || !sessionId) {\n      return NextResponse.json(\n        { error: 'Query and sessionId are required' },\n        { status: 400 }\n      )\n    }\n\n    console.log(`[AgentNetwork] Starting network generation for query: \"${query}\" with model: ${modelId}`)\n\n    // Create progress callback\n    const progressCallback = (progress: GenerationProgress) => {\n      progressMap.set(sessionId, progress)\n    }\n\n    // Start network generation in background\n    generateNetworkInBackground(query, modelId, sessionId, progressCallback)\n\n    return NextResponse.json({\n      success: true,\n      sessionId,\n      message: 'Network generation started'\n    })\n\n  } catch (error) {\n    console.error('[AgentNetwork] Error starting network generation:', error)\n    \n    return NextResponse.json(\n      { \n        error: 'Failed to start network generation',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url)\n  const sessionId = searchParams.get('sessionId')\n  \n  if (!sessionId) {\n    return NextResponse.json(\n      { error: 'Session ID is required' },\n      { status: 400 }\n    )\n  }\n  \n  try {\n    const progress = progressMap.get(sessionId)\n    \n    // Check if generation is complete\n    let network: NetworkData | null = null\n    let complete = false\n    \n    if (progress && progress.step === 'complete') {\n      // In a real implementation, you'd retrieve the completed network\n      // For now, we'll simulate completion\n      network = await getCompletedNetwork(sessionId)\n      complete = network !== null\n      \n      if (complete) {\n        // Clean up progress\n        progressMap.delete(sessionId)\n      }\n    }\n    \n    return NextResponse.json({\n      progress,\n      network,\n      complete\n    })\n    \n  } catch (error) {\n    console.error('[AgentNetwork] Error getting progress:', error)\n    \n    return NextResponse.json(\n      { \n        error: 'Failed to get progress',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      },\n      { status: 500 }\n    )\n  }\n}\n\n// Background function to generate network\nasync function generateNetworkInBackground(\n  query: string, \n  modelId: string, \n  sessionId: string, \n  progressCallback: (progress: GenerationProgress) => void\n) {\n  try {\n    const agent = new KnowledgeNetworkAgent(modelId, sessionId, progressCallback)\n    const networkData = await agent.generateNetwork(query)\n    \n    // Store completed network (in production, use database)\n    await storeCompletedNetwork(sessionId, networkData)\n    \n    // Mark as complete\n    progressCallback({\n      step: 'complete',\n      progress: 100,\n      message: 'Knowledge network generated successfully!',\n      timestamp: Date.now()\n    })\n    \n  } catch (error) {\n    console.error('[AgentNetwork] Background generation failed:', error)\n    \n    // Mark as error\n    progressCallback({\n      step: 'error',\n      progress: 0,\n      message: `Generation failed: ${error instanceof Error ? error.message : 'Unknown error'}`,\n      timestamp: Date.now()\n    })\n  }\n}\n\n// In-memory storage for completed networks (in production, use database)\nconst completedNetworks = new Map<string, NetworkData>()\n\nasync function storeCompletedNetwork(sessionId: string, networkData: NetworkData) {\n  completedNetworks.set(sessionId, networkData)\n}\n\nasync function getCompletedNetwork(sessionId: string): Promise<NetworkData | null> {\n  return completedNetworks.get(sessionId) || null\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,qEAAqE;AACrE,MAAM,cAAc,IAAI;AAEjB,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG,MAAM,QAAQ,IAAI;QAExD,IAAI,CAAC,SAAS,CAAC,WAAW;YACxB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAmC,GAC5C;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,GAAG,CAAC,CAAC,uDAAuD,EAAE,MAAM,cAAc,EAAE,SAAS;QAErG,2BAA2B;QAC3B,MAAM,mBAAmB,CAAC;YACxB,YAAY,GAAG,CAAC,WAAW;QAC7B;QAEA,yCAAyC;QACzC,4BAA4B,OAAO,SAAS,WAAW;QAEvD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA,SAAS;QACX;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qDAAqD;QAEnE,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,IAAI,OAAoB;IAC5C,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,YAAY,aAAa,GAAG,CAAC;IAEnC,IAAI,CAAC,WAAW;QACd,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;IAEA,IAAI;QACF,MAAM,WAAW,YAAY,GAAG,CAAC;QAEjC,kCAAkC;QAClC,IAAI,UAA8B;QAClC,IAAI,WAAW;QAEf,IAAI,YAAY,SAAS,IAAI,KAAK,YAAY;YAC5C,iEAAiE;YACjE,qCAAqC;YACrC,UAAU,MAAM,oBAAoB;YACpC,WAAW,YAAY;YAEvB,IAAI,UAAU;gBACZ,oBAAoB;gBACpB,YAAY,MAAM,CAAC;YACrB;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA;QACF;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0CAA0C;QAExD,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEA,0CAA0C;AAC1C,eAAe,4BACb,KAAa,EACb,OAAe,EACf,SAAiB,EACjB,gBAAwD;IAExD,IAAI;QACF,MAAM,QAAQ,IAAI,yKAAqB,CAAC,SAAS,WAAW;QAC5D,MAAM,cAAc,MAAM,MAAM,eAAe,CAAC;QAEhD,wDAAwD;QACxD,MAAM,sBAAsB,WAAW;QAEvC,mBAAmB;QACnB,iBAAiB;YACf,MAAM;YACN,UAAU;YACV,SAAS;YACT,WAAW,KAAK,GAAG;QACrB;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gDAAgD;QAE9D,gBAAgB;QAChB,iBAAiB;YACf,MAAM;YACN,UAAU;YACV,SAAS,CAAC,mBAAmB,EAAE,iBAAiB,QAAQ,MAAM,OAAO,GAAG,iBAAiB;YACzF,WAAW,KAAK,GAAG;QACrB;IACF;AACF;AAEA,yEAAyE;AACzE,MAAM,oBAAoB,IAAI;AAE9B,eAAe,sBAAsB,SAAiB,EAAE,WAAwB;IAC9E,kBAAkB,GAAG,CAAC,WAAW;AACnC;AAEA,eAAe,oBAAoB,SAAiB;IAClD,OAAO,kBAAkB,GAAG,CAAC,cAAc;AAC7C"}}]
}