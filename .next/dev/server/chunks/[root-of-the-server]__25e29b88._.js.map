{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///data/OpenAlex-Analysis/InnoSciHub/scientific-knowledge-navigation/lib/model-config.ts"],"sourcesContent":["export const MODEL_CONFIG = {\n  apiKey:\n    \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJHcm91cE5hbWUiOiJTaGliaW5nIFhpYW5nIiwiVXNlck5hbWUiOiJTaGliaW5nIFhpYW5nIiwiQWNjb3VudCI6IiIsIlN1YmplY3RJRCI6IjE5ODMzMzg3ODkzNTQ4NzM0MjQiLCJQaG9uZSI6IjE1MjgwOTk1NjIzIiwiR3JvdXBJRCI6IjE5ODMzMzg3ODkzNDY0ODQ4MTYiLCJQYWdlTmFtZSI6IiIsIk1haWwiOiIiLCJDcmVhdGVUaW1lIjoiMjAyNS0xMS0xNyAwMTo0NzoxMiIsIlRva2VuVHlwZSI6NCwiaXNzIjoibWluaW1heCJ9.J9DXYnr6kbFABZZREpiuEJFsjIq7gSfNcHqjlBVc0RhPV3ayukzfpQOdescWWt_dDNar704FKZ3ObhVlv8SoZqVZBgqRY754M5xdkGtZ83ytI0MF6eXTyPVMho-L_NFM7ZagKhSXuDJS8M5dZ6ccZfcsK8zHFh6mUuhJV9x2-jyoUPFtWNNCfYEitOfGdxuxIoiJdvHz6mJNRfhVGELxhw1kr6v-xwf3CEAILZCYSABIGfeTkL6IrC69JpPheN8pgCASD_Qh6wKlGZnrNiHV5sFcBP-ADELucPT5QSo_Wj7MvsG9csHeONubxxYKKK6S5TvEIuGLnmCjcRG5k1mEiA\",\n  baseURL: \"https://api.minimaxi.com/v1\",\n  model: \"MiniMax-M2-Stable\",\n}\n\nexport const PRESET_MODELS = [\n  {\n    id: \"doubao-pro\",\n    name: \"Doubao Seed 1.6 Lite\",\n    baseURL: \"https://ark.cn-beijing.volces.com/api/v3\",\n    connectionURL: \"https://ark.cn-beijing.volces.com/api/v3/chat/completions\",\n    apiKey: \"2ee34654-7f98-46bc-b879-6ed4fb57eddf\",\n    model: \"doubao-seed-1-6-lite-251015\",\n    provider: \"doubao\",\n  },\n  {\n    id: \"minimax\",\n    name: \"MiniMax M2\",\n    baseURL: \"https://api.minimaxi.com/v1\",\n    connectionURL: \"https://api.minimaxi.com/v1/chat/completions\",\n    apiKey: MODEL_CONFIG.apiKey,\n    model: \"MiniMax-M2-Stable\",\n    provider: \"minimax\",\n  },\n  {\n    id: \"ChatGLM\",\n    name: \"ChatGLM-4.6\",\n    baseURL: \"https://open.bigmodel.cn/api/coding/paas/v4\",\n    connectionURL: \"https://open.bigmodel.cn/api/coding/paas/v4/chat/completions\",\n    apiKey: MODEL_CONFIG.apiKey,\n    model: \"glm-4.6\",\n    provider: \"ChatGLM\",\n  }\n]\n"],"names":[],"mappings":";;;;;;AAAO,MAAM,eAAe;IAC1B,QACE;IACF,SAAS;IACT,OAAO;AACT;AAEO,MAAM,gBAAgB;IAC3B;QACE,IAAI;QACJ,MAAM;QACN,SAAS;QACT,eAAe;QACf,QAAQ;QACR,OAAO;QACP,UAAU;IACZ;IACA;QACE,IAAI;QACJ,MAAM;QACN,SAAS;QACT,eAAe;QACf,QAAQ,aAAa,MAAM;QAC3B,OAAO;QACP,UAAU;IACZ;IACA;QACE,IAAI;QACJ,MAAM;QACN,SAAS;QACT,eAAe;QACf,QAAQ,aAAa,MAAM;QAC3B,OAAO;QACP,UAAU;IACZ;CACD"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///data/OpenAlex-Analysis/InnoSciHub/scientific-knowledge-navigation/actions/generate-network.ts"],"sourcesContent":["\"use server\"\n\nimport { MODEL_CONFIG } from \"@/lib/model-config\"\n\nexport type ModelConfig = typeof MODEL_CONFIG\n\nexport async function generateNetworkFromText(text: string, configOverride?: Partial<ModelConfig>) {\n  const config = { ...MODEL_CONFIG, ...configOverride }\n\n  console.log(\"[v0] Generating network with model:\", config.model)\n\n  const apiUrl = (configOverride as any)?.connectionURL || config.baseURL\n\n  try {\n    const response = await fetch(apiUrl, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${config.apiKey}`,\n      },\n      body: JSON.stringify({\n        model: config.model,\n        messages: [\n          {\n            role: \"system\",\n            content: `You are a scientific knowledge graph extractor. \n            Analyze the user's scientific text and extract key entities (Concepts, Methods, Metrics) and their relationships.\n            \n            Return ONLY a valid JSON object with this exact structure, no markdown formatting, no explanation:\n            {\n              \"nodes\": [\n                { \"id\": \"string\", \"label\": \"string\", \"type\": \"concept\" | \"entity\" | \"method\" }\n              ],\n              \"links\": [\n                { \"source\": \"id_of_source_node\", \"target\": \"id_of_target_node\", \"label\": \"relationship_name\" }\n              ]\n            }\n            `,\n          },\n          {\n            role: \"user\",\n            content: text,\n          },\n        ],\n        stream: false,\n      }),\n    })\n\n    if (!response.ok) {\n      const errorText = await response.text()\n      console.error(`[v0] API Error: ${response.status} - ${apiUrl} - ${errorText}`)\n      throw new Error(`API Error: ${response.status} - ${errorText}`)\n    }\n\n    const data = await response.json()\n\n    if (!data.choices || !data.choices[0] || !data.choices[0].message) {\n      throw new Error(\"Invalid API response structure\")\n    }\n\n    const content = data.choices[0].message.content\n\n    // Robust JSON Extraction\n    let parsedData\n    let extractionError = null\n    try {\n      // 1. Try direct parse\n      parsedData = JSON.parse(content)\n    } catch (e) {\n      // 2. Try extracting from markdown block\n      const jsonMatch = content.match(/```json\\n?([\\s\\S]*?)\\n?```/)\n      if (jsonMatch && jsonMatch[1]) {\n        try {\n          parsedData = JSON.parse(jsonMatch[1])\n        } catch (e2) {\n          // 3. Try finding first { and last }\n          const start = content.indexOf(\"{\")\n          const end = content.lastIndexOf(\"}\")\n          if (start !== -1 && end !== -1) {\n            const jsonString = content.substring(start, end + 1)\n            parsedData = JSON.parse(jsonString)\n          } else {\n            extractionError = \"Could not parse JSON from model output\"\n          }\n        }\n      } else {\n        // 3. Fallback: Try finding first { and last } directly\n        const start = content.indexOf(\"{\")\n        const end = content.lastIndexOf(\"}\")\n        if (start !== -1 && end !== -1) {\n          const jsonString = content.substring(start, end + 1)\n          parsedData = JSON.parse(jsonString)\n        } else {\n          extractionError = \"Could not parse JSON from model output\"\n        }\n      }\n    }\n\n    if (extractionError || !parsedData) {\n      console.warn(\"[v0] JSON extraction failed, returning raw content:\", content.substring(0, 100))\n      return {\n        nodes: [],\n        links: [],\n        rawContent: content,\n        error: extractionError,\n      }\n    }\n\n    // Validations for response structure\n    if (!parsedData.nodes || !Array.isArray(parsedData.nodes)) {\n      return {\n        nodes: [],\n        links: [],\n        rawContent: content,\n        error: \"Missing 'nodes' array in JSON output\",\n      }\n    }\n\n    const nodes = parsedData.nodes.map((node: any, i: number) => ({\n      ...node,\n      // Random initial position for the force layout to organize\n      x: Math.random() * 800 + 100,\n      y: Math.random() * 600 + 100,\n      // Assign radius based on type\n      radius: node.type === \"concept\" ? 30 : node.type === \"method\" ? 25 : 20,\n    }))\n\n    const links = (parsedData.links || []).map((link: any) => ({\n      source: link.source,\n      target: link.target,\n      type: \"relates_to\",\n      label: link.label,\n    }))\n\n    return { nodes, links, rawContent: content }\n  } catch (error) {\n    console.error(\"[v0] Generation failed:\", error)\n    console.log(\"[v0] Falling back to simulation mode due to error\")\n\n    const nodeCount = Math.max(5, Math.min(15, Math.floor(text.length / 20)))\n    const newNodes = Array.from({ length: nodeCount }).map((_, i) => ({\n      id: `generated-${i}`,\n      x: Math.random() * 800 + 100,\n      y: Math.random() * 600 + 100,\n      type: i % 3 === 0 ? \"concept\" : i % 3 === 1 ? \"entity\" : \"method\",\n      label: `Extracted Term ${i + 1}`,\n      radius: i % 3 === 0 ? 30 : 20,\n    }))\n\n    const newLinks = newNodes.slice(1).map((node, i) => ({\n      source: newNodes[0].id,\n      target: node.id,\n      type: \"relates_to\",\n      label: \"connected_to\",\n    }))\n\n    return { nodes: newNodes, links: newLinks, isFallback: true, error: String(error) }\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 253, "column": 0}, "map": {"version":3,"sources":["file:///data/OpenAlex-Analysis/InnoSciHub/scientific-knowledge-navigation/app/api/generate-network/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { generateNetworkFromText } from '@/actions/generate-network'\nimport { PRESET_MODELS } from '@/lib/model-config'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { query, modelId } = await request.json()\n\n    if (!query) {\n      return NextResponse.json(\n        { error: 'Query is required' },\n        { status: 400 }\n      )\n    }\n\n    // Get model configuration\n    const modelConfig = PRESET_MODELS.find(m => m.id === modelId) || PRESET_MODELS[0]\n\n    console.log(`[v0] Generating network for query: \"${query}\" using model: ${modelConfig.name}`)\n\n    // Generate network using the server action\n    const result = await generateNetworkFromText(query, {\n      apiKey: modelConfig.apiKey,\n      baseURL: modelConfig.baseURL,\n      model: modelConfig.model\n    })\n\n    console.log(`[v0] Network generated successfully: ${result.nodes.length} nodes, ${result.links.length} links`)\n\n    return NextResponse.json({\n      success: true,\n      data: result,\n      metadata: {\n        model: modelConfig.name,\n        query: query,\n        nodeCount: result.nodes.length,\n        linkCount: result.links.length,\n        timestamp: new Date().toISOString()\n      }\n    })\n\n  } catch (error) {\n    console.error('[v0] Network generation error:', error)\n    \n    return NextResponse.json(\n      { \n        error: 'Failed to generate network',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      },\n      { status: 500 }\n    )\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE7C,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,0BAA0B;QAC1B,MAAM,cAAc,yIAAa,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,YAAY,yIAAa,CAAC,EAAE;QAEjF,QAAQ,GAAG,CAAC,CAAC,oCAAoC,EAAE,MAAM,eAAe,EAAE,YAAY,IAAI,EAAE;QAE5F,2CAA2C;QAC3C,MAAM,SAAS,MAAM,IAAA,2JAAuB,EAAC,OAAO;YAClD,QAAQ,YAAY,MAAM;YAC1B,SAAS,YAAY,OAAO;YAC5B,OAAO,YAAY,KAAK;QAC1B;QAEA,QAAQ,GAAG,CAAC,CAAC,qCAAqC,EAAE,OAAO,KAAK,CAAC,MAAM,CAAC,QAAQ,EAAE,OAAO,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC;QAE7G,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;YACN,UAAU;gBACR,OAAO,YAAY,IAAI;gBACvB,OAAO;gBACP,WAAW,OAAO,KAAK,CAAC,MAAM;gBAC9B,WAAW,OAAO,KAAK,CAAC,MAAM;gBAC9B,WAAW,IAAI,OAAO,WAAW;YACnC;QACF;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAEhD,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}