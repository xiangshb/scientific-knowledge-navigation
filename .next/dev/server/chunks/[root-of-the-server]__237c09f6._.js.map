{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///data/OpenAlex-Analysis/InnoSciHub/scientific-knowledge-navigation/app/api/mock-stream/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json();\n    const { prompt, config } = body;\n    \n    console.log(\"模拟流式API接收到:\", { prompt, config });\n\n    // 创建一个模拟的AI对话流式响应\n    const encoder = new TextEncoder();\n    const stream = new ReadableStream({\n      async start(controller) {\n        try {\n          // 模拟AI模型的普通对话响应\n          const generateAIResponse = async () => {\n            // 根据用户输入生成相应的回复\n            let response = \"\";\n            \n            if (prompt.includes(\"你好\") || prompt.includes(\"hi\") || prompt.includes(\"hello\")) {\n              response = `你好！我是${config?.model || 'AI助手'}。很高兴为您服务！有什么我可以帮助您的吗？`;\n            } else if (prompt.includes(\"你是谁\")) {\n              response = `我是一个AI语言模型，基于${config?.model || 'GPT技术'}构建。我可以回答问题、提供信息和协助您完成各种任务。`;\n            } else if (prompt.includes(\"天气\")) {\n              response = `很抱歉，我无法获取实时天气信息。建议您查看天气预报应用或网站获取最新的天气情况。`;\n            } else if (prompt.includes(\"时间\")) {\n              const now = new Date();\n              response = `当前时间是：${now.toLocaleString('zh-CN')}`;\n            } else if (prompt.includes(\"中国\") && prompt.includes(\"直辖市\")) {\n              response = `中国有4个直辖市：\\n\\n1. 北京市\\n2. 上海市\\n3. 天津市\\n4. 重庆市\\n\\n这些是中国的省级行政单位，直接由中央政府管辖。`;\n            } else if (prompt.includes(\"中国\") && prompt.includes(\"直辖市\") && prompt.includes(\"详细\")) {\n              response = `中国共有4个直辖市，均为中央直接管辖的省级行政区。以下是对四个直辖市的详细介绍：\n\n## 北京市\n**核心定位**：中华人民共和国首都，全国政治中心、文化中心、国际交往中心、科技创新中心。\n**基本概况**：面积约1.64万平方公里，常住人口约2188.7万。\n**经济特色**：2023年GDP约4.16万亿元，总部经济、金融服务、科技创新产业发达。\n**文化特色**：拥有故宫、长城、天坛等世界文化遗产，高校科研资源密集。\n\n## 上海市\n**核心定位**：全国经济中心、金融中心、贸易中心、航运中心、科技创新中心。\n**基本概况**：面积约6340平方公里，常住人口约2487.1万。\n**经济特色**：GDP常年居全国第一，2023年约4.72万亿元，浦东开发开放为核心标志。\n**文化特色**：海派文化融合中西，外滩、豫园、迪士尼等为标志，是长三角城市群龙头。\n\n## 天津市\n**核心定位**：北方重要经济中心、国际港口城市、生态宜居城市，京津冀协同发展核心城市之一。\n**基本概况**：面积约1.19万平方公里，常住人口约1386.6万。\n**经济特色**：北方航运中心，2023年GDP约1.67万亿元，先进制造业发达。\n**文化特色**：津派文化代表，相声发源地之一，五大道、古文化街等为标志。\n\n## 重庆市\n**核心定位**：西南地区重要中心城市、长江上游经济中心、国家现代制造业基地、西部大开发战略支点。\n**基本概况**：面积约8.24万平方公里，常住人口约3205.4万。\n**经济特色**：西部GDP第一，2023年约3.29万亿元，汽车制造、电子信息产业发达。\n**文化特色**：巴渝文化代表，火锅文化全球知名，长江三峡、大足石刻为世界遗产。\n\n四个直辖市均为区域发展的核心引擎，在国家发展中具有重要作用。`;\n            } else {\n              // 默认回复\n              response = `感谢您的提问：\"${prompt}\"\\n\\n这是一个很有趣的问题。作为AI助手，我会尽力为您提供准确和有用的信息。\\n\\n如果您需要更具体的帮助，请告诉我更多详情，这样我可以给您更精准的回答。`;\n            }\n            \n            // 按词语和短语发送响应，提供更自然的阅读体验\n            const words = response.split(/(\\s+|[，。！？；：、])/).filter(word => word.trim());\n            \n            for (const word of words) {\n              if (word.trim()) {\n                await sendChunk(word);\n                \n                // 根据词语类型调整延迟\n                let delay;\n                if (/^[，。！？；：]$/.test(word)) {\n                  delay = Math.random() * 200 + 100; // 标点符号较长延迟\n                } else if (/^\\s+$/.test(word)) {\n                  delay = Math.random() * 50 + 20; // 空格较短延迟\n                } else if (word.length <= 2) {\n                  delay = Math.random() * 80 + 40; // 短词中等延迟\n                } else {\n                  delay = Math.random() * 120 + 60; // 长词较长延迟\n                }\n                \n                await new Promise(resolve => setTimeout(resolve, delay));\n              }\n            }\n            \n            // 发送完成信号\n            await sendDone();\n          };\n          \n          const sendChunk = async (content: string) => {\n            const data = `data: ${JSON.stringify({ content })}\\n\\n`;\n            controller.enqueue(encoder.encode(data));\n          };\n          \n          const sendDone = async () => {\n            const endData = `data: ${JSON.stringify({ done: true })}\\n\\n`;\n            controller.enqueue(encoder.encode(endData));\n            controller.close();\n          };\n          \n          // 开始生成AI响应\n          await generateAIResponse();\n          \n        } catch (error) {\n          console.error(\"流式生成错误:\", error);\n          const errorData = `data: ${JSON.stringify({ error: error instanceof Error ? error.message : String(error) })}\\n\\n`;\n          controller.enqueue(encoder.encode(errorData));\n          controller.close();\n        }\n      }\n    });\n\n    return new Response(stream, {\n      headers: {\n        'Content-Type': 'text/event-stream',\n        'Cache-Control': 'no-cache',\n        'Connection': 'keep-alive',\n      },\n    });\n  } catch (error) {\n    console.error(\"模拟流式API错误:\", error);\n    return new Response(JSON.stringify({\n      error: error instanceof Error ? error.message : String(error),\n      status: \"error\"\n    }), {\n      status: 500,\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    });\n  }\n}"],"names":[],"mappings":"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"}}]
}